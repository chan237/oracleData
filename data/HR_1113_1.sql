CREATE SEQUENCE EMP_SEQ
START WITH 1
INCREMENT BY 1
MINVALUE 1
MAXVALUE 100000
NOCYCLE CACHE 2;

DROP SEQUENCE EMP_SEQ;
CREATE TABLE EMP01
AS SELECT EMPLOYEE_ID, FIRST_NAME, HIRE_DATE
FROM EMPLOYEES WHERE 1=0;

SELECT * FROM EMP01;

INSERT INTO EMP01 VALUES(EMP_SEQ.nextval, 'JULIA', SYSDATE);

SELECT EMP_SEQ.CURRVAL FROM DUAL;


CREATE SEQUENCE DEPT_SEQ
START WITH 1
INCREMENT BY 10
MAXVALUE 30;

SELECT * FROM USER_SEQUENCE;

CREATE TABLE DETP02
AS SELECT DEPARTMENT_ID, DEPARTMENT_NAME, LOCATION_ID FROM DEPARTMENTS WHERE 1=0;

INSERT INTO DETP02 VALUES (DEPT_SEQ.NEXTVAL,'인사과',1);
INSERT INTO DETP02 VALUES (DEPT_SEQ.NEXTVAL,'총무과',2);
INSERT INTO DETP02 VALUES (DEPT_SEQ.NEXTVAL,'서무과',3);
INSERT INTO DETP02 VALUES (DEPT_SEQ.NEXTVAL,'교육과',4);
SELECT * FROM DETP02;

--시퀸스 수정
ALTER SEQUENCE DEPT_SEQ
MAXVALUE 100;

SELECT * FROM user_sequences;
SELECT * FROM DEPARTMENTS WHERE department_id=30;
SELECT * FROM employees WHERE department_id=30;
SELECT * FROM DEPARTMENTS;

--1. 사원 번호와 사원명과 부서명과 부서의 위치를 출력하는 뷰(VIEW_LOC)를 작성하라
--사원번호,사원명=>EMPLOYEES 부서명,부서위치=>DEPARTMENT ...JOIN사용
CREATE VIEW VIEW_LOC AS SELECT 
    E.EMPLOYEE_ID,
    E.FIRST_NAME,
    D.DEPARTMENT_NAME,
    D.LOCATION_ID
FROM EMPLOYEES E JOIN DEPARTMENTS D 
ON E.DEPARTMENT_ID = D.DEPARTMENT_ID;
--결과 확인    
SELECT * FROM VIEW_LOC;

--2.30번 부서 소속 사원의 이름과 입사일과 부서명을 출력하는 뷰(VIEW_DEPT30)를 작성하라.
--30번 부서 SELECT * FROM DEPARTMENTS WHERE DEPARTMENT_ID = 30
--출력해야 하는 것 E.FIRST_NAME, E.HIRE_DATE, D.DEPARTMENT_NAME
CREATE VIEW VIEW_DEPT30 AS SELECT
    E.FIRST_NAME,
    E.HIRE_DATE,
    D.DEPARTMENT_NAME
    FROM EMPLOYEES E JOIN DEPARTMENTS D ON
    E.DEPARTMENT_ID = D.DEPARTMENT_ID WHERE D.DEPARTMENT_ID = 30;
--결과 확인
SELECT * FROM VIEW_DEPT30;

--3.부서별 최대 급여 정보를 가지는 뷰(VIEW_DEPT_MAXSAL)를 생성하라
--부서별로 묶어야 하므로 GROUP BY, 최대 급여는 MAX(SALARY), 
--단 MAX(무언가)를 쓸때에는 이름을 붙여줘야 한다.(오류 뜸..)
CREATE VIEW VIEW_DEPT_MAXSAL AS SELECT 
    DEPARTMENT_ID, MAX(SALARY) AS MAXSALARY FROM EMPLOYEES GROUP BY DEPARTMENT_ID;
    
SELECT * FROM VIEW_DEPT_MAXSAL;

--4.급여를 많이 받는 순서대로 3명만 출력하는 뷰(VIEW_SAL_TOP3)와 인라인 뷰로 작성하라.
--일단 ROWNUM을 써야할거같다.
    
CREATE VIEW VIEW_SAL_TOP3 AS SELECT
FIRST_NAME, SALARY FROM EMPLOYEES WHERE ROWNUM <= 3 ORDER BY SALARY DESC;

SELECT * FROM VIEW_SAL_TOP3;



